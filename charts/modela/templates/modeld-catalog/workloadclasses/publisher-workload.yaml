apiVersion: catalog.modela.ai/v1alpha1
kind: WorkloadClass
metadata:
  name: publisher-workload-class
  namespace: modela-catalog
spec:
  dataImage: quay.io/metaprov/modela-data-plane:{{ .Chart.AppVersion }}
  controlImage: quay.io/metaprov/modela-workload:{{ .Chart.AppVersion }}
  trainerImage: quay.io/metaprov/modela-trainer:{{ .Chart.AppVersion }}
  publisherImage: quay.io/metaprov/modela-publisher:{{ .Chart.AppVersion }}
  podTemplate:
      spec:
        restartPolicy: Never
        containers:
          - name: control
            image: quay.io/metaprov/modela-workload:{{ .Chart.AppVersion }}
            imagePullPolicy: IfNotPresent
            ports:
                - containerPort: 8080
            volumeMounts:
                - name: data
                  mountPath: /var/opt/modela/data
          - name: publisher
            image: quay.io/metaprov/modela-publisher:{{ .Chart.AppVersion }}
            imagePullPolicy: IfNotPresent
            ports:
             - containerPort: 8050
               name: http
             - containerPort: 9090
               name: metrics
            volumeMounts:
             - name: data
               mountPath: /var/opt/modela/data
            resources:
                  limits:
                    cpu: 500m
                    memory: 800Mi
                  requests:
                    cpu: 500m
                    memory: 800Mi
            env:
                  - name: HOST
                    value: "0.0.0.0"
                  - name: PORT
                    value: "8080"
                  - name: DEBUG
                    value: "true"
                  - name: ENV
                    value: "dev"
                  - name: CACHE_PATH
                    value: "/var/opt/modela/data"
                  - name: CLOUDS_HOST
                    value: "127.0.0.1"
                  - name: CLOUDS_PORT
                    value: "8090"

          - name: storage
            image: quay.io/metaprov/modela-cloud-proxy:{{ .Chart.AppVersion }}
            imagePullPolicy: IfNotPresent
            ports:
               - name: http
                 containerPort: 8090
            volumeMounts:
                - name: data
                  mountPath: /var/opt/modela/data
        volumes:
          - name: data
            emptyDir: {}
          